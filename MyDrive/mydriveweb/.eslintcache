[{"D:\\git\\misc\\MyDrive\\mydriveweb\\src\\index.js":"1","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\App.js":"2","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\reportWebVitals.js":"3","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\loginpage.js":"4","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\context.js":"5","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\registerpage.js":"6","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\homepage.js":"7","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\service.js":"8"},{"size":500,"mtime":499162500000,"results":"9","hashOfConfig":"10"},{"size":1311,"mtime":1613621827346,"results":"11","hashOfConfig":"10"},{"size":362,"mtime":499162500000,"results":"12","hashOfConfig":"10"},{"size":2835,"mtime":1614189827229,"results":"13","hashOfConfig":"10"},{"size":84,"mtime":1612309860563,"results":"14","hashOfConfig":"10"},{"size":3073,"mtime":1614190169225,"results":"15","hashOfConfig":"10"},{"size":6113,"mtime":1614189723588,"results":"16","hashOfConfig":"10"},{"size":3774,"mtime":1614187415775,"results":"17","hashOfConfig":"10"},{"filePath":"18","messages":"19","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},"48jfpe",{"filePath":"21","messages":"22","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"23","usedDeprecatedRules":"20"},{"filePath":"24","messages":"25","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},{"filePath":"26","messages":"27","errorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"28","usedDeprecatedRules":"20"},{"filePath":"29","messages":"30","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":"20"},{"filePath":"31","messages":"32","errorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":null},{"filePath":"33","messages":"34","errorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"35","usedDeprecatedRules":"20"},{"filePath":"36","messages":"37","errorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0},"D:\\git\\misc\\MyDrive\\mydriveweb\\src\\index.js",[],["38","39"],"D:\\git\\misc\\MyDrive\\mydriveweb\\src\\App.js",["40","41"],"import './App.css';\nimport React, { useContext, useState } from 'react';\nimport { Switch, Route, BrowserRouter as Router } from 'react-router-dom';\nimport _ from 'underscore';\n\nimport { SessionContext } from './context';\nimport { LoginPage } from './loginpage';\nimport { HomePage } from './homepage';\nimport { RegisterPage } from './registerpage';\n\nfunction App() {\n  const getCookie = (name) => {\n    const row = document.cookie\n      .split('; ')\n      .find(row => row.startsWith(name));\n\n    if (row) {\n      return row.split('=')[1];\n    }\n  };\n\n  const userId = getCookie(\"userId\");\n  const folderId = getCookie(\"folderId\");\n  const token = getCookie(\"jwttokencookie\");\n  const userName = getCookie(\"username\");\n\n  const [context, setContext] = useState({\n    userId,\n    userName,\n    folderId,\n    token,\n  });\n\n  const updateContext = (newContext) => {\n    setContext(_.defaults(newContext, context));\n  };\n\n  return (\n    <SessionContext.Provider value={{ globalContext: context, updateContext }}>\n      <Router>\n        <Route path=\"/\">\n          <HomePage />\n        </Route>\n        <Route path=\"/login\">\n          <LoginPage />\n        </Route>\n        <Route path=\"/register\">\n          <RegisterPage />\n        </Route>\n      </Router>\n    </SessionContext.Provider>\n  );\n}\n\nexport default App;\n","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\reportWebVitals.js",[],"D:\\git\\misc\\MyDrive\\mydriveweb\\src\\loginpage.js",["42","43","44"],"\r\nimport { Redirect, Link } from 'react-router-dom';\r\nimport { Button } from 'react-bootstrap';\r\nimport { useContext, useState } from 'react';\r\nimport { useHistory } from \"react-router-dom\";\r\nimport jwt_decode from \"jwt-decode\";\r\nimport Promise from 'bluebird';\r\nimport {sha256} from \"js-sha256\";\r\n\r\nimport { SessionContext } from './context';\r\nimport { Login } from './service';\r\n\r\nexport function LoginPage() {\r\n    const [username, setusername] = useState(null);\r\n    const [password, setpassword] = useState(null);\r\n    const [authErr, setAuthErr] = useState(false);\r\n\r\n    let history = useHistory();\r\n\r\n    const context = useContext(SessionContext)\r\n\r\n    const usernamechanged = (e) => {\r\n        setusername(e.target.value);\r\n    }\r\n\r\n    const passwordchanged = (e) => {\r\n        setpassword(e.target.value);\r\n    }\r\n\r\n    const loginCallback = (response) => {\r\n        if (response) {\r\n            var decoded = jwt_decode(response);\r\n            context.updateContext({\r\n                userId: decoded.userId,\r\n                userName: decoded.username,\r\n                folderId: decoded.rootfolderId,\r\n                token: response,                \r\n            });\r\n            history.push('/')\r\n            // parse JWT token and populate data into global context\r\n        } else {\r\n            setAuthErr(false);\r\n        }\r\n    };\r\n\r\n    const loginErrorCallback = (status) => {\r\n        setAuthErr(true);\r\n    };\r\n\r\n    const login = () => {\r\n        // hash password\r\n        const passwordStream = new TextEncoder().encode(password);\r\n        const sha = sha256.create();\r\n        sha.update(password);\r\n        // sha.hex();\r\n        Login(username, sha.hex(), loginCallback, loginErrorCallback);\r\n\r\n        // Promise.resolve(crypto.subtle.digest('SHA-256', passwordStream)).then(hashBuffer => {\r\n        //     const hashArray = Array.from(new Uint8Array(hashBuffer));                     // convert buffer to byte array\r\n        //     const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); // convert bytes to hex string\r\n        //     Login(username, hashHex, loginCallback, loginErrorCallback);\r\n        // });\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <h1>Welcome to MyDrive, or your drive! Please log in</h1>\r\n            <h2>if you have not registered before, please register first</h2>\r\n            <Link to=\"/register\">Switch to register</Link>\r\n            <br />\r\n            <br />\r\n            <h2>User name</h2>\r\n            <input className=\"username\" onChange={usernamechanged} />\r\n            <h2>Password</h2>\r\n            <input className=\"password\" type=\"password\" onChange={passwordchanged} />\r\n            <Button onClick={login}>Login</Button>\r\n            {authErr && <div>Authentication failed, please try again</div>}\r\n        </div>\r\n    )\r\n};\r\n","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\context.js",[],"D:\\git\\misc\\MyDrive\\mydriveweb\\src\\registerpage.js",["45","46","47","48","49"],"D:\\git\\misc\\MyDrive\\mydriveweb\\src\\homepage.js",["50","51"],"/* eslint-disable jsx-a11y/anchor-is-valid */\r\nimport { Redirect } from 'react-router-dom';\r\nimport { useContext, useState } from 'react';\r\nimport { Button, Modal } from 'react-bootstrap';\r\nimport Promise from 'bluebird';\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nimport _ from 'underscore';\r\n\r\nimport { SessionContext } from './context';\r\nimport { listFolder, UploadFiles, DownloadFile, CreateFolder, GetParentFolder, DeleteFile } from './service';\r\n\r\nexport function HomePage() {\r\n    const [files, setFiles] = useState(null);\r\n    const [creatingFolder, setCreatingFolder] = useState(false);\r\n    const [newFolderName, setNewFolderName] = useState(\"\");\r\n    let history = useHistory();\r\n\r\n    const listCallback = (response) => {\r\n        if (response) {\r\n            var list = JSON.parse(response);\r\n            setFiles(list);\r\n        }\r\n    };\r\n\r\n    const listErrorcallback = () => {\r\n        history.push('/login')\r\n    };\r\n\r\n    const uploadCallback = (response) => {\r\n        // on successful upload, call listFolder to reload the file list\r\n        listFolder(\r\n            context.globalContext.userId,\r\n            context.globalContext.folderId,\r\n            context.globalContext.token,\r\n            listCallback,\r\n            listErrorcallback\r\n        );\r\n    };\r\n\r\n    const uploadErrorCallback = () => {\r\n\r\n    };\r\n\r\n    const onCreateFolderClicks = () => {\r\n        setCreatingFolder(true);\r\n        setNewFolderName(\"\");\r\n    }\r\n\r\n    const context = useContext(SessionContext);\r\n\r\n    if (!files) {\r\n        if (!context.globalContext || !context.globalContext.userId) {\r\n            return <Redirect to=\"/login\" />;\r\n        } else {\r\n            listFolder(\r\n                context.globalContext.userId,\r\n                context.globalContext.folderId,\r\n                context.globalContext.token,\r\n                listCallback,\r\n                listErrorcallback\r\n            );\r\n        }\r\n    }\r\n\r\n    const onFileChange = (e) => {\r\n        // setSelectedFiles(e.target.files);\r\n        UploadFiles(\r\n            context.globalContext.userId,\r\n            context.globalContext.folderId,\r\n            e.target.files,\r\n            context.globalContext.token,\r\n            uploadCallback,\r\n            uploadErrorCallback\r\n        );\r\n    };\r\n\r\n    const onDownload = (blob, fileName ) => {\r\n        var a = document.createElement(\"a\");\r\n        a.href = URL.createObjectURL(blob);\r\n        a.download = fileName;\r\n        a.hidden = true;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n    }\r\n\r\n    const uploadFile = () => (<div>\r\n        <input type=\"file\" id=\"input\" multiple onChange={onFileChange} />\r\n        </div>\r\n    );\r\n\r\n    const openFile = (file) => {\r\n        if (file.fileType === \"Folder\") {\r\n            setFiles(null);\r\n            context.updateContext({\r\n                folderId: file.fileId\r\n            });\r\n        } else {\r\n            DownloadFile(context.globalContext.userId, file.fileId, file.fileName, context.globalContext.token, onDownload);\r\n        }\r\n    };\r\n\r\n    const creatingCancelClicked = () =>{\r\n        setCreatingFolder(false);\r\n        setNewFolderName(\"\");\r\n    }\r\n\r\n    const creatingOKClicked = () =>{\r\n        setCreatingFolder(false);   \r\n        CreateFolder(context.globalContext.userId, context.globalContext.folderId, newFolderName, context.globalContext.token, uploadCallback);\r\n    }\r\n\r\n    const getparentCallback = (parentFolderId) => {\r\n        if (parentFolderId && parentFolderId.length > 0) {\r\n            setFiles(null);\r\n            context.updateContext({\r\n                folderId: parentFolderId\r\n            });\r\n        }\r\n    }\r\n\r\n    const deleteClicked = (fileId) =>{\r\n        // delete file or folder\r\n        DeleteFile(context.globalContext.userId, fileId, context.globalContext.token, deleteCallback);\r\n    }\r\n\r\n    const deleteCallback = () => {\r\n        // on delete success, refresh folder\r\n        listFolder(\r\n            context.globalContext.userId,\r\n            context.globalContext.folderId,\r\n            context.globalContext.token,\r\n            listCallback,\r\n            listErrorcallback\r\n        );        \r\n    }\r\n\r\n    const onGoUpClick = () => {\r\n        GetParentFolder(context.globalContext.userId, context.globalContext.folderId, context.globalContext.token, getparentCallback)\r\n    }\r\n\r\n    const newFolderNameUpdated = (e) => {\r\n        setNewFolderName(e.target.value);\r\n    }\r\n\r\n    const buildFileList = () => _.map(_.sortBy(files, f => f.fileName.toLowerCase()), file => (<div>\r\n        <button onClick={() => deleteClicked(file.fileId)}>\r\n            Delete\r\n        </button>\r\n        <a\r\n            className={file.fileType}\r\n            href={`javascript:void(0)`}\r\n            onClick={() => openFile(file)}\r\n        >\r\n            {`${file.fileType === \"Folder\" ? \"<<<Folder>>> \" : \"\"}${file.fileName}`}\r\n        </a>\r\n        <br />\r\n    </div>));\r\n\r\n    console.log(files);\r\n\r\n    return (\r\n        <div>\r\n            {(!files || files.length === 0)  && \r\n                <div>Seems you don't have anything here...</div>\r\n            }\r\n            <br/>            \r\n            {uploadFile()}\r\n            <br/>\r\n            <Button onClick={onCreateFolderClicks}>Create folder</Button>\r\n            <Button onClick={onGoUpClick}>Go up</Button>\r\n            <Modal show={creatingFolder}>\r\n                <Modal.Header>\r\n                    <Modal.Title>Please enter new folder name:</Modal.Title>\r\n                </Modal.Header>\r\n                <Modal.Body>\r\n                    <input className=\"newFolderName\" onChange={newFolderNameUpdated} />\r\n                </Modal.Body>\r\n                <Modal.Footer>\r\n                    <Button className=\"creatingOK\" disabled={newFolderName.length === 0} onClick={creatingOKClicked}>OK</Button>\r\n                    <Button className=\"creatingCancel\" onClick={creatingCancelClicked}>Cancel</Button>\r\n                </Modal.Footer>\r\n            </Modal>\r\n            <br/>\r\n            { (files && files.length > 0) && \r\n                buildFileList()\r\n            }\r\n        </div>\r\n    );\r\n};\r\n","D:\\git\\misc\\MyDrive\\mydriveweb\\src\\service.js",[],{"ruleId":"52","replacedBy":"53"},{"ruleId":"54","replacedBy":"55"},{"ruleId":"56","severity":1,"message":"57","line":2,"column":17,"nodeType":"58","messageId":"59","endLine":2,"endColumn":27},{"ruleId":"56","severity":1,"message":"60","line":3,"column":10,"nodeType":"58","messageId":"59","endLine":3,"endColumn":16},{"ruleId":"56","severity":1,"message":"61","line":2,"column":10,"nodeType":"58","messageId":"59","endLine":2,"endColumn":18},{"ruleId":"56","severity":1,"message":"62","line":7,"column":8,"nodeType":"58","messageId":"59","endLine":7,"endColumn":15},{"ruleId":"56","severity":1,"message":"63","line":52,"column":15,"nodeType":"58","messageId":"59","endLine":52,"endColumn":29},{"ruleId":"56","severity":1,"message":"61","line":2,"column":10,"nodeType":"58","messageId":"59","endLine":2,"endColumn":18},{"ruleId":"56","severity":1,"message":"57","line":3,"column":10,"nodeType":"58","messageId":"59","endLine":3,"endColumn":20},{"ruleId":"56","severity":1,"message":"64","line":5,"column":10,"nodeType":"58","messageId":"59","endLine":5,"endColumn":24},{"ruleId":"56","severity":1,"message":"62","line":9,"column":8,"nodeType":"58","messageId":"59","endLine":9,"endColumn":15},{"ruleId":"56","severity":1,"message":"63","line":15,"column":15,"nodeType":"58","messageId":"59","endLine":15,"endColumn":29},{"ruleId":"56","severity":1,"message":"62","line":5,"column":8,"nodeType":"58","messageId":"59","endLine":5,"endColumn":15},{"ruleId":"65","severity":1,"message":"66","line":152,"column":19,"nodeType":"67","messageId":"68","endLine":152,"endColumn":39},"no-native-reassign",["69"],"no-negated-in-lhs",["70"],"no-unused-vars","'useContext' is defined but never used.","Identifier","unusedVar","'Switch' is defined but never used.","'Redirect' is defined but never used.","'Promise' is defined but never used.","'passwordStream' is assigned a value but never used.","'SessionContext' is defined but never used.","no-script-url","Script URL is a form of eval.","TemplateLiteral","unexpectedScriptURL","no-global-assign","no-unsafe-negation"]